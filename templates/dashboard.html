{% extends "base.html" %}

{% block title %}Dashboard - Afya Medical EHR{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        background: linear-gradient(135deg, rgba(46, 139, 87, 0.1), rgba(32, 178, 170, 0.1));
        border-radius: 20px;
        padding: 3rem 2rem;
        margin-bottom: 2rem;
    }

    .ussd-code {
        background: #212529;
        color: #ffc107;
        padding: 15px 25px;
        border-radius: 10px;
        font-family: 'Courier New', monospace;
        font-size: 1.5rem;
        font-weight: bold;
        letter-spacing: 2px;
        border: 3px solid var(--afya-primary);
        display: inline-block;
        animation: pulse-glow 3s infinite;
        cursor: pointer;
    }

    .stat-card {
        background: linear-gradient(135deg, var(--afya-primary), var(--afya-secondary));
        color: white;
        border-radius: 15px;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    .icon-large {
        font-size: 3rem;
        opacity: 0.8;
    }

    .feature-card {
        border-radius: 15px;
        transition: all 0.3s ease;
        border: 1px solid #e9ecef;
    }

    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .feature-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, var(--afya-primary), var(--afya-secondary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
        margin: 0 auto 1.5rem;
    }

    .system-status .badge {
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
    }

    .quick-actions .btn {
        border-radius: 10px;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .quick-actions .btn:hover {
        transform: translateY(-2px);
    }

    .demo-info {
        background: linear-gradient(135deg, #fff3cd, #ffeaa7);
        border: 2px solid #ffc107;
        border-radius: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Hero Section -->
    <div class="hero-section text-center mb-5">
        <h1 class="display-4 fw-bold text-dark mb-3">
            <i class="fas fa-heartbeat text-success me-3"></i>
            Welcome to Afya Medical EHR
        </h1>
        <p class="lead text-muted mb-4">
            Transforming Healthcare Records in Ghana - One Phone at a Time
        </p>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card border-0 bg-dark text-white shadow">
                    <div class="card-body text-center py-4">
                        <h5 class="card-title mb-3">USSD Access Code</h5>
                        <div class="ussd-code">*714#</div>
                        <p class="small mt-3 mb-0 opacity-75">Dial from any mobile phone - No internet required</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-5">
        <div class="col-md-3 mb-3">
            <div class="card stat-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-user-md icon-large mb-3"></i>
                    <h3 class="card-title mb-2">{{ total_providers or 0 }}</h3>
                    <p class="card-text mb-0">Healthcare Providers</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card stat-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-hospital icon-large mb-3"></i>
                    <h3 class="card-title mb-2">{{ total_facilities or 0 }}</h3>
                    <p class="card-text mb-0">Healthcare Facilities</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card stat-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-users icon-large mb-3"></i>
                    <h3 class="card-title mb-2">{{ total_patients or 0 }}</h3>
                    <p class="card-text mb-0">Total Patients</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card stat-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-file-medical icon-large mb-3"></i>
                    <h3 class="card-title mb-2">{{ recent_records|length or 0 }}</h3>
                    <p class="card-text mb-0">Recent Records</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Features -->
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="text-center mb-4">
                <i class="fas fa-star text-warning me-2"></i>
                Key Features
            </h2>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card feature-card h-100">
                <div class="card-body text-center">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h5 class="card-title">USSD Access</h5>
                    <p class="card-text">
                        Works on any mobile phone - from basic feature phones to smartphones.
                        No internet connection required.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card feature-card h-100">
                <div class="card-body text-center">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h5 class="card-title">Secure & Private</h5>
                    <p class="card-text">
                        End-to-end encryption, role-based access controls, and
                        HIPAA-compliant data protection.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card feature-card h-100">
                <div class="card-body text-center">
                    <div class="feature-icon">
                        <i class="fas fa-globe-africa"></i>
                    </div>
                    <h5 class="card-title">Nationwide Access</h5>
                    <p class="card-text">
                        Patient records accessible from any healthcare facility
                        across Ghana - rural or urban.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Row -->
    <div class="row">
        <!-- Recent Medical Records -->
        <div class="col-md-8 mb-4">
            <div class="card card-custom">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-clock me-2 text-primary"></i>
                        Recent Medical Records
                    </h5>
                </div>
                <div class="card-body">
                    {% if recent_records %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Date</th>
                                    <th>Patient</th>
                                    <th>Provider</th>
                                    <th>Facility</th>
                                    <th>Diagnosis</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in recent_records %}
                                <tr>
                                    <td>
                                        <small class="text-muted">{{ record.visit_date }}</small>
                                    </td>
                                    <td>
                                        <strong>{{ record.patient.name }}</strong>
                                        <br>
                                        <small class="text-muted">{{ record.patient.phone }}</small>
                                    </td>
                                    <td>{{ record.provider.name }}</td>
                                    <td>{{ record.facility.name }}</td>
                                    <td>
                                        {% if record.diagnosis %}
                                        {{ record.diagnosis[:50] }}
                                        {% if record.diagnosis|length > 50 %}...{% endif %}
                                        {% else %}
                                        <em class="text-muted">Not specified</em>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center mt-3">
                        <a href="/patients" class="btn btn-outline-primary">
                            <i class="fas fa-eye me-1"></i>View All Records
                        </a>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-file-medical fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No medical records yet</h5>
                        <p class="text-muted">Records will appear here as healthcare providers create them</p>
                        <a href="/test-ussd" class="btn btn-outline-warning me-2">
                            <i class="fas fa-mobile-alt me-2"></i>Test USSD
                        </a>
                        <a href="/logs" class="btn btn-outline-secondary">
                            <i class="fas fa-list me-2"></i>View System Logs
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Quick Actions & System Status -->
        <div class="col-md-4">
            <!-- Quick Actions -->
            <div class="card card-custom mb-4">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-bolt me-2 text-warning"></i>
                        Quick Actions
                    </h5>
                </div>
                <div class="card-body quick-actions">
                    <div class="d-grid gap-2">
                        <a href="/register-facility" class="btn btn-outline-primary">
                            <i class="fas fa-hospital me-2"></i>Register Facility
                        </a>
                        <a href="/register-provider" class="btn btn-outline-success">
                            <i class="fas fa-user-md me-2"></i>Register Provider
                        </a>
                        <a href="/patients" class="btn btn-outline-info">
                            <i class="fas fa-search me-2"></i>View Patients
                        </a>
                        <a href="/test-ussd" class="btn btn-outline-warning">
                            <i class="fas fa-mobile-alt me-2"></i>Test USSD
                        </a>
                        <a href="/providers" class="btn btn-outline-secondary">
                            <i class="fas fa-user-md me-2"></i>All Providers
                        </a>
                        <a href="/facilities" class="btn btn-outline-dark">
                            <i class="fas fa-hospital me-2"></i>All Facilities
                        </a>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="card card-custom mb-4">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-heartbeat me-2 text-success"></i>
                        System Status
                    </h5>
                </div>
                <div class="card-body system-status">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <span>USSD Gateway</span>
                        <span class="badge bg-success">
                            <i class="fas fa-check-circle me-1"></i>Online
                        </span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <span>Database</span>
                        <span class="badge bg-success">
                            <i class="fas fa-check-circle me-1"></i>Connected
                        </span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <span>SMS Service</span>
                        <span class="badge bg-success">
                            <i class="fas fa-check-circle me-1"></i>Active
                        </span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between">
                        <span>Web Interface</span>
                        <span class="badge bg-success">
                            <i class="fas fa-check-circle me-1"></i>Operational
                        </span>
                    </div>
                    <hr>
                    <div class="text-center">
                        <a href="/health" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-chart-line me-1"></i>Detailed Status
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Usage Instructions -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card border-0 bg-light">
                <div class="card-body">
                    <h3 class="text-center mb-4">
                        <i class="fas fa-question-circle text-info me-2"></i>
                        How to Use Afya Medical EHR
                    </h3>
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="fas fa-user-md text-primary me-2"></i>For Healthcare Providers:</h5>
                            <ol class="list-unstyled">
                                <li class="mb-2">
                                    <span class="badge bg-primary rounded-pill me-2">3</span>
                                    Select "Healthcare Provider" and enter your PIN
                                </li>
                                <li class="mb-2">
                                    <span class="badge bg-primary rounded-pill me-2">4</span>
                                    Register patients, create records, view histories
                                </li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="fas fa-user text-success me-2"></i>For Patients:</h5>
                            <ol class="list-unstyled">
                                <li class="mb-2">
                                    <span class="badge bg-success rounded-pill me-2">1</span>
                                    Get registered at any participating healthcare facility
                                </li>
                                <li class="mb-2">
                                    <span class="badge bg-success rounded-pill me-2">2</span>
                                    Dial <strong>*714#</strong> from your registered phone
                                </li>
                                <li class="mb-2">
                                    <span class="badge bg-success rounded-pill me-2">3</span>
                                    Select "Patient Services" to view your records
                                </li>
                                <li class="mb-2">
                                    <span class="badge bg-success rounded-pill me-2">4</span>
                                    Access your health information from anywhere in Ghana
                                </li>
                            </ol>
                        </div>
                    </div>

                    <!-- Demo Information -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="demo-info p-4">
                                <h6 class="alert-heading mb-3">
                                    <i class="fas fa-info-circle me-2"></i>Demo Information
                                </h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <strong>Demo Provider PINs:</strong>
                                        <ul class="mb-0 mt-2">
                                            <li><code>1234</code> - Dr. Kwame Asante (General Medicine)</li>
                                            <li><code>5678</code> - Dr. Ama Mensah (Pediatrics)</li>
                                            <li><code>9012</code> - Dr. Kofi Boateng (Internal Medicine)</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Test Phone Numbers:</strong>
                                        <ul class="mb-0 mt-2">
                                            <li><code>0200123456</code> - John Doe</li>
                                            <li><code>0240234567</code> - Jane Smith</li>
                                            <li><code>0260345678</code> - Kwame Osei</li>
                                            <li><code>0270456789</code> - Akosua Addo</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // USSD code click to copy functionality
    document.querySelector('.ussd-code').addEventListener('click', function() {
        navigator.clipboard.writeText('*714#').then(function() {
            const ussdCode = document.querySelector('.ussd-code');
            const originalText = ussdCode.textContent;
            ussdCode.textContent = 'Copied!';
            ussdCode.style.background = '#28a745';
            setTimeout(function() {
                ussdCode.textContent = originalText;
                ussdCode.style.background = '#212529';
            }, 2000);
        });
    });

    // Update system status indicators dynamically
    function updateSystemStatus() {
        fetch('/health', {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('System health:', data);
            if (data.status === 'healthy') {
                document.querySelectorAll('.system-status .badge').forEach(badge => {
                    if (badge.textContent.includes('Online') ||
                        badge.textContent.includes('Connected') ||
                        badge.textContent.includes('Active') ||
                        badge.textContent.includes('Operational')) {
                        badge.className = 'badge bg-success';
                    }
                });
            }
        })
        .catch(error => {
            console.warn('Health check failed:', error);
        });
    }

    // Check system status every 30 seconds
    updateSystemStatus();
    setInterval(updateSystemStatus, 30000);
</script>
{% endblock %}-2">
                                    <span class="badge bg-primary rounded-pill me-2">1</span>
                                    Register your facility and get provider credentials
                                </li>
                                <li class="mb-2">
                                    <span class="badge bg-primary rounded-pill me-2">2</span>
                                    Dial <strong>*714#</strong> from any mobile phone
                                </li>
                                <li class="mb